---
title: Visualising Neighbouring Polygons in R
type: post
author: Michael Harper
date: '2020-07-02'
draft: false
slug: calculating-neighbouring-polygons-in-r
categories:
  - GIS
  - R
tags:
  - GIS
  - R
description: Guide on how to make neighbouring boundary maps in R.
header_image: "/images/coverNeighbouring.png"
---

<script src="/rmarkdown-libs/header-attrs/header-attrs.js"></script>


<p>A while back on StackOverflow, I <a href="https://stackoverflow.com/questions/45682226/r-counting-how-many-polygons-between-two/47007246#47007246">answered a question</a> on how to produce a map which showed how many polygons away a location was from another, as shown in Figure <a href="#fig:mapResult">1</a>. This blog provides an update on how this can be used, with some slight tweaks to the answer to expand on the original. A lot of this content is based around the original from <a href="https://cran.r-project.org/web/packages/spdep/vignettes/nb_igraph.html">Roger Bivand</a> here.</p>
<div class="figure" style="text-align: center"><span id="fig:mapResult"></span>
<img src="https://i.stack.imgur.com/6kBT6.png" alt="The final output!" width="100%" />
<p class="caption">
Figure 1: The final output!
</p>
</div>
<div id="setup" class="section level1">
<h1>Setup</h1>
<p>In order to calculate neighbouring polygons, we need to form a network of nodes for the data. This is done using the <strong>igraph</strong> <span class="citation">[@R-igraph]</span> <strong>spdep</strong> <span class="citation">[@R-spdep]</span> and <strong>spatialreg</strong> <span class="citation">[@R-spatialreg]</span> packages. We also use the <strong>raster</strong> <span class="citation">[@R-raster]</span> package to download some example data, and <strong>ggplot2</strong> <span class="citation">[@R-ggplot2]</span> for the final visualisation.</p>
<p>First downloading the data as follows. The input data is shown in Figure <a href="#fig:loadData">2</a>. You could easily provide your own shapefile here instead or run the code for a different country by changing the three-digit code. For my example, I have selected Hungary:</p>
<div class="figure" style="text-align: center"><span id="fig:loadData"></span>
<img src="/post/2018-03-02-calculating-neighbouring-polygons-in-r/2018-03-02-calculating-neighbouring-polygons-in-r_files/figure-html/loadData-1.png" alt="Loaded data for the raster package" width="100%" />
<p class="caption">
Figure 2: Loaded data for the raster package
</p>
</div>
<div id="extracting-neigbours" class="section level2">
<h2>Extracting neigbours</h2>
<p>Firstly the <code>poly2nb</code> function is used to calculate neighbouring regions, based on contiguous boundaries, that is sharing one or more boundary point. The resulting mesh and coordinates is shown in Figure <a href="#fig:produceMesh">3</a></p>
<div class="figure" style="text-align: center"><span id="fig:produceMesh"></span>
<img src="/post/2018-03-02-calculating-neighbouring-polygons-in-r/2018-03-02-calculating-neighbouring-polygons-in-r_files/figure-html/produceMesh-1.png" alt="Mesh outputs from poly2nb" width="100%" />
<p class="caption">
Figure 3: Mesh outputs from poly2nb
</p>
</div>
<p>With this mesh, we can then calculate the shortest path between two locations. The follow function returns a list for each and every pair of polygons.</p>
<p>Having made the calculations, the data can now be formatted to get into plotting format, so the shortest path matrix is merged with the spatial dataframe.</p>
<p>The data is now in a suitable format to display. Using the basic function <code>spplot</code> we can get a graph quite quickly:</p>
<p><img src="/post/2018-03-02-calculating-neighbouring-polygons-in-r/2018-03-02-calculating-neighbouring-polygons-in-r_files/figure-html/unnamed-chunk-5-1.png" width="100%" style="display: block; margin: auto;" /></p>
</div>
</div>
<div id="plotting-in-ggplot2" class="section level1">
<h1>Plotting in ggplot2</h1>
<p>I prefer ggplot for plotting more complex graphs as you can control the styling easier. Fortunately, <strong>ggplot2</strong> now directly supports spatial data through <code>geom_sf</code> format. I have customised it a bit by removing elements which arenâ€™t required and added a background. The final map is shown below in Figure <a href="#fig:finalMap">4</a>.</p>
<div class="figure" style="text-align: center"><span id="fig:finalMap"></span>
<img src="/post/2018-03-02-calculating-neighbouring-polygons-in-r/2018-03-02-calculating-neighbouring-polygons-in-r_files/figure-html/finalMap-1.png" alt="Final Neighbouring Region Map" width="100%" />
<p class="caption">
Figure 4: Final Neighbouring Region Map
</p>
</div>
</div>
